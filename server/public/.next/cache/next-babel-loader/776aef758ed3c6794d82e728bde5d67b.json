{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/longjiuwei/html,css,js/xiaogao_blog/web/components/puzzleVerify/index.tsx\";\nimport React, { useEffect, useState, useRef } from 'react';\nimport Styles from './index.module.scss';\nlet saveIntervalX = 0;\nlet saveIntervalY = 0;\n\nconst PuzzleVerify = props => {\n  const sliderBtn = useRef(null);\n  const sliderBar = useRef(null);\n  const puzzleBox = useRef(null);\n  const puzzleShow = useRef(null);\n  const puzzle_lost_box = useRef(null);\n  const verTips = useRef(null);\n  const {\n    0: moveLeft,\n    1: setMoveLeft\n  } = useState(-130);\n  const {\n    0: verifyStatus,\n    1: setVerifyStatus\n  } = useState(false);\n  let moveStart = 0;\n  useEffect(() => {\n    initBgCanvas();\n  }, []);\n\n  const startMove = e => {\n    e = e || window.event;\n    moveStart = e.pageX || e.targetTouches[0].pageX;\n    addMouseMoveListener();\n  };\n\n  const moving = e => {\n    e = e || window.event;\n    const moveX = e.pageX || e.targetTouches[0].pageX; // 线的总长度\n\n    const sliderClientWidth = sliderBar.current.clientWidth; // 移动的距离\n\n    const moveDistance = moveX - moveStart; // btn 按钮移动的最大偏移量\n    //  0 > 移动的距离  >  总长度 - 按钮的宽度\n\n    if (moveDistance >= sliderClientWidth - 40 || moveDistance < 0) {\n      return;\n    } // 图片移动的最偏移量\n    // 0> (随机图片的x 位置 + 55 =  图片距离 左边的偏移量) + 移动的距离  > 总长度\n\n\n    if (saveIntervalX + 55 + moveDistance > sliderClientWidth) {\n      return;\n    }\n\n    setMoveLeft(moveLeft + moveDistance);\n    sliderBtn.current.style.transition = 'inherit';\n    puzzle_lost_box.current.style.transition = 'inherit';\n    sliderBtn.current.style.left = moveDistance + 'px';\n  };\n\n  const endMove = e => {\n    const left = puzzle_lost_box.current.style.left.substr(0, 1);\n    verTips.current.style.bottom = '0px';\n\n    if (left == 0) {\n      setVerifyStatus(true);\n      props.verifyResponse(true);\n    } else {\n      setVerifyStatus(false);\n      props.verifyResponse(false);\n    }\n\n    removeMouseMoveListener();\n    setTimeout(() => {\n      sliderBtn.current.style.left = 0 + 'px';\n      sliderBtn.current.style.transition = 'left .5s';\n      puzzle_lost_box.current.style.transition = 'left .5s';\n      verTips.current.style.bottom = '-40px';\n      setMoveLeft(-130);\n    }, 500);\n  };\n\n  const random = (min, max) => {\n    return Math.floor(Math.random() * (max - min));\n  };\n\n  const initBgCanvas = () => {\n    const ctx = puzzleBox.current.getContext('2d');\n    saveIntervalX = random(0, 70); //  随机x位置\n\n    saveIntervalY = random(25, -25); //  随机y位置\n\n    const d = 55 / 3; // 绘制小方块 /3 \n\n    renderCanvas(puzzleBox.current, saveIntervalX, saveIntervalY, d);\n    renderCanvas(puzzleShow.current, saveIntervalX, saveIntervalY, d);\n    ctx.restore();\n  };\n\n  const renderCanvas = (type, x, y, d) => {\n    const canvas = type.getContext('2d');\n    canvas.clearRect(0, 0, 260, 160);\n    canvas.save();\n    canvas.translate(130, 80);\n\n    if (type.id === 'puzzle_box') {\n      canvas.globalCompositeOperation = \"xor\";\n      canvas.fillStyle = \"#fff\";\n    }\n\n    canvas.beginPath();\n    canvas.moveTo(x, y);\n    canvas.lineTo(x + d, y);\n    canvas.bezierCurveTo(x + d, y - d, x + 2 * d, y - d, x + 2 * d, y);\n    canvas.lineTo(x + 3 * d, y);\n    canvas.lineTo(x + 3 * d, y + d);\n    canvas.bezierCurveTo(x + 2 * d, y + d, x + 2 * d, y + 2 * d, x + 3 * d, y + 2 * d);\n    canvas.lineTo(x + 3 * d, y + 3 * d);\n    canvas.lineTo(x, y + 3 * d);\n    canvas.closePath();\n\n    if (type.id === 'puzzleShow') {\n      canvas.clip();\n      canvas.fill();\n    } else {\n      canvas.strokeStyle = \"rgba(0,0,0,0)\";\n      canvas.stroke();\n      canvas.fill();\n    }\n\n    canvas.restore();\n  };\n\n  const refresh = () => {\n    initBgCanvas();\n  };\n\n  const addMouseMoveListener = () => {\n    document.addEventListener(\"mousemove\", moving);\n    document.addEventListener(\"touchmove\", moving);\n    document.addEventListener(\"mouseup\", endMove);\n    document.addEventListener(\"touchend\", endMove);\n  };\n\n  const removeMouseMoveListener = () => {\n    document.removeEventListener(\"mousemove\", moving);\n    document.removeEventListener(\"touchmove\", moving);\n    document.removeEventListener(\"mouseup\", endMove);\n    document.removeEventListener(\"touchend\", endMove);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: Styles.container,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: Styles.header,\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: Styles.char,\n        children: \"\\u62D6\\u52A8\\u4E0B\\u65B9\\u6ED1\\u5757\\u5B8C\\u6210\\u62FC\\u56FE\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: Styles.icon,\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"iconfont icon-shuaxin\",\n          onClick: refresh\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"iconfont icon-close\",\n          onClick: () => props.close()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: Styles.verify,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: Styles.negative,\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          src: \"/image/bg.png\",\n          alt: \"\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n          width: \"260\",\n          height: \"160\",\n          id: \"puzzle_box\",\n          ref: puzzleBox\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: Styles.puzzle_lost_box,\n        ref: puzzle_lost_box,\n        style: {\n          left: moveLeft + 'px'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"canvas\", {\n          width: \"260\",\n          height: \"160\",\n          id: \"puzzleShow\",\n          ref: puzzleShow\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: Styles.ver_tips,\n        ref: verTips,\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: `iconfont ${verifyStatus ? 'icon-Success' : 'icon-x'}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: verifyStatus ? \"验证通过\" : '验证失败，请移动到正确位置！'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: Styles.slider,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: Styles.bar,\n        id: \"sliderBar\",\n        ref: sliderBar\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: Styles.btn,\n        onMouseDown: startMove,\n        onTouchStart: startMove,\n        ref: sliderBtn,\n        id: \"sliderBtn\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 165,\n    columnNumber: 12\n  }, this);\n};\n\nexport default PuzzleVerify;","map":{"version":3,"sources":["/Users/longjiuwei/html,css,js/xiaogao_blog/web/components/puzzleVerify/index.tsx"],"names":["React","useEffect","useState","useRef","Styles","saveIntervalX","saveIntervalY","PuzzleVerify","props","sliderBtn","sliderBar","puzzleBox","puzzleShow","puzzle_lost_box","verTips","moveLeft","setMoveLeft","verifyStatus","setVerifyStatus","moveStart","initBgCanvas","startMove","e","window","event","pageX","targetTouches","addMouseMoveListener","moving","moveX","sliderClientWidth","current","clientWidth","moveDistance","style","transition","left","endMove","substr","bottom","verifyResponse","removeMouseMoveListener","setTimeout","random","min","max","Math","floor","ctx","getContext","d","renderCanvas","restore","type","x","y","canvas","clearRect","save","translate","id","globalCompositeOperation","fillStyle","beginPath","moveTo","lineTo","bezierCurveTo","closePath","clip","fill","strokeStyle","stroke","refresh","document","addEventListener","removeEventListener","container","header","char","icon","close","verify","negative","ver_tips","slider","bar","btn"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from 'react'\nimport Styles from './index.module.scss'\nlet saveIntervalX = 0\nlet saveIntervalY = 0\n\ninterface IVerify {\n    verifyResponse: (flg: boolean) => void\n    close: () => void\n}\n\nconst PuzzleVerify: React.FC<IVerify> = (props) => {\n\n    const sliderBtn = useRef<any>(null)\n    const sliderBar = useRef<any>(null)\n    const puzzleBox = useRef<any>(null)\n    const puzzleShow = useRef<any>(null)\n    const puzzle_lost_box = useRef<any>(null)\n    const verTips = useRef<any>(null)\n    const [moveLeft, setMoveLeft] = useState<number>(-130)\n    const [verifyStatus, setVerifyStatus] = useState<boolean>(false)\n\n    let moveStart = 0;\n\n    useEffect(() => {\n        initBgCanvas()\n    }, [])\n\n\n    const startMove = (e) => {\n\n        e = e || window.event;\n        moveStart = e.pageX || e.targetTouches[0].pageX\n        addMouseMoveListener()\n    }\n\n    const moving = (e) => {\n\n        e = e || window.event;\n        const moveX = e.pageX || e.targetTouches[0].pageX;\n        // 线的总长度\n        const sliderClientWidth = sliderBar.current.clientWidth;\n        // 移动的距离\n        const moveDistance = moveX - moveStart;\n\n        // btn 按钮移动的最大偏移量\n        //  0 > 移动的距离  >  总长度 - 按钮的宽度\n        if (moveDistance >= sliderClientWidth - 40 || moveDistance < 0) {\n            return\n        }\n\n        // 图片移动的最偏移量\n        // 0> (随机图片的x 位置 + 55 =  图片距离 左边的偏移量) + 移动的距离  > 总长度\n        if (saveIntervalX + 55 + moveDistance > sliderClientWidth) {\n            return\n        }\n\n        setMoveLeft(moveLeft + moveDistance)\n\n        sliderBtn.current.style.transition = 'inherit'\n\n        puzzle_lost_box.current.style.transition = 'inherit'\n\n        sliderBtn.current.style.left = moveDistance + 'px'\n\n\n    }\n\n    const endMove = (e) => {\n\n        const left = puzzle_lost_box.current.style.left.substr(0, 1)\n        verTips.current.style.bottom = '0px';\n        if (left == 0) {\n            setVerifyStatus(true)\n            props.verifyResponse(true)\n        } else {\n            setVerifyStatus(false)\n          \n            props.verifyResponse(false)\n        }\n        removeMouseMoveListener()\n        setTimeout(() => {\n            sliderBtn.current.style.left = 0 + 'px'\n            sliderBtn.current.style.transition = 'left .5s'\n            puzzle_lost_box.current.style.transition = 'left .5s'\n            verTips.current.style.bottom = '-40px';\n            setMoveLeft(-130)\n        }, 500);\n    }\n    const random = (min, max) => {\n        return Math.floor(Math.random() * (max - min));\n    }\n\n    const initBgCanvas = () => {\n\n        const ctx = puzzleBox.current.getContext('2d');\n\n        saveIntervalX = random(0, 70); //  随机x位置\n        saveIntervalY = random(25, -25); //  随机y位置\n        const d = 55 / 3; // 绘制小方块 /3 \n\n\n\n        renderCanvas(puzzleBox.current, saveIntervalX, saveIntervalY, d)\n        renderCanvas(puzzleShow.current, saveIntervalX, saveIntervalY, d)\n        ctx.restore();\n\n    }\n\n\n    const renderCanvas = (type, x: number, y: number, d: number) => {\n\n        const canvas = type.getContext('2d');\n        canvas.clearRect(0, 0, 260, 160);\n        canvas.save();\n\n        canvas.translate(130, 80);\n        if (type.id === 'puzzle_box') {\n            canvas.globalCompositeOperation = \"xor\"\n            canvas.fillStyle = \"#fff\"\n        }\n        canvas.beginPath()\n\n        canvas.moveTo(x, y);\n        canvas.lineTo(x + d, y);\n        canvas.bezierCurveTo(x + d, y - d, x + 2 * d, y - d, x + 2 * d, y);\n        canvas.lineTo(x + 3 * d, y);\n\n        canvas.lineTo(x + 3 * d, y + d);\n        canvas.bezierCurveTo(x + 2 * d, y + d, x + 2 * d, y + 2 * d, x + 3 * d, y + 2 * d)\n\n        canvas.lineTo(x + 3 * d, y + 3 * d)\n        canvas.lineTo(x, y + 3 * d)\n        canvas.closePath()\n\n        if (type.id === 'puzzleShow') {\n            canvas.clip()\n            canvas.fill()\n\n        } else {\n            canvas.strokeStyle = \"rgba(0,0,0,0)\"\n            canvas.stroke()\n            canvas.fill()\n        }\n        canvas.restore();\n    }\n\n\n    const refresh = () => {\n        initBgCanvas()\n    }\n\n    const addMouseMoveListener = () => {\n        document.addEventListener(\"mousemove\", moving);\n        document.addEventListener(\"touchmove\", moving);\n        document.addEventListener(\"mouseup\", endMove);\n        document.addEventListener(\"touchend\", endMove);\n    }\n    const removeMouseMoveListener = () => {\n        document.removeEventListener(\"mousemove\", moving);\n        document.removeEventListener(\"touchmove\", moving);\n        document.removeEventListener(\"mouseup\", endMove);\n        document.removeEventListener(\"touchend\", endMove);\n    }\n\n    return <div className={Styles.container}>\n        <div className={Styles.header}>\n            <span className={Styles.char}>拖动下方滑块完成拼图</span>\n            <div className={Styles.icon}>\n                <i className='iconfont icon-shuaxin' onClick={refresh}></i>\n                <i className='iconfont icon-close' onClick={() => props.close()}></i>\n            </div>\n        </div>\n        <div className={Styles.verify}>\n            <div className={Styles.negative}>\n                <img src=\"/image/bg.png\" alt=\"\" />\n                <canvas width=\"260\" height=\"160\" id=\"puzzle_box\" ref={puzzleBox}></canvas>\n            </div>\n            <div className={Styles.puzzle_lost_box} ref={puzzle_lost_box} style={{ left: moveLeft + 'px' }}>\n                <canvas width='260' height='160' id='puzzleShow' ref={puzzleShow}></canvas>\n            </div>\n            <div className={Styles.ver_tips} ref={verTips}>\n                <i className={`iconfont ${verifyStatus ? 'icon-Success' : 'icon-x'}`}></i>\n                <span>{verifyStatus ? \"验证通过\" : '验证失败，请移动到正确位置！'}</span>\n            </div>\n        </div>\n        <div className={Styles.slider}>\n            <div className={Styles.bar} id='sliderBar' ref={sliderBar}>\n            </div>\n            <div className={Styles.btn} onMouseDown={startMove} onTouchStart={startMove} ref={sliderBtn} id=\"sliderBtn\">\n                <span></span>\n                <span></span>\n                <span></span>\n            </div>\n        </div>\n    </div>\n}\nexport default PuzzleVerify"]},"metadata":{},"sourceType":"module"}