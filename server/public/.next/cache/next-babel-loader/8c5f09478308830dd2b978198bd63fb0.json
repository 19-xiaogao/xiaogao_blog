{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport React, { useEffect, useState } from 'react';\nimport Styles from '../styles/blogDetail/index.module.scss';\nimport moment from 'moment';\nimport marked from 'marked';\nimport { message } from 'antd';\nimport PageHeader from './components/Header';\nimport PuzzleVerify from './components/puzzleVerify';\nimport { getBlogDetail, getIndexPageData, goodLikeBlog, blog_createComment, get_blogComment } from '../api/api';\nimport LoadingDom from './components/loading';\nimport { headerType } from '../types/response';\nimport { Email } from '../util/RegExp';\n\nconst BlogDetail = props => {\n  let section = null;\n  const {\n    0: comment,\n    1: setComment\n  } = useState([]);\n  const {\n    0: total,\n    1: setTotal\n  } = useState(0);\n  const {\n    0: likeTody,\n    1: setLikeTody\n  } = useState(false);\n  const {\n    0: scrollWidth,\n    1: setScrollWidth\n  } = useState('0%');\n  const {\n    0: commentName,\n    1: setCommentName\n  } = useState('');\n  const {\n    0: commentEmail,\n    1: setCommentEmail\n  } = useState('');\n  const {\n    0: context,\n    1: setContext\n  } = useState('');\n  const {\n    0: errorInfo,\n    1: setErrorInfo\n  } = useState('~认真和用心是一种态度, 感谢支持~');\n  const {\n    0: openValidation,\n    1: setValidation\n  } = useState(false);\n  const {\n    0: pageSize,\n    1: setPageSize\n  } = useState(5);\n  const {\n    0: loadingMore,\n    1: SetLoading\n  } = useState(false);\n  const {\n    blogDetail\n  } = props;\n  useEffect(() => {\n    section = document.getElementById('section');\n    goodLikeBlog({\n      id: blogDetail.id,\n      like: false\n    });\n    disposeLikeTody();\n    window.addEventListener('scroll', scrollBar, false);\n    return () => window.removeEventListener('scroll', scrollBar, false);\n  }, []); // 获取评论数据\n\n  useEffect(() => {\n    (async () => {\n      const {\n        success,\n        data\n      } = await get_blogComment({\n        id: props.blogDetail.id,\n        pageNo: 1,\n        pageSize: pageSize\n      });\n      if (!success) return message.warn('请求错误---getStaticProps');\n      setComment(data.list);\n      setTotal(data.total);\n    })();\n  }, []);\n\n  const scrollBar = () => {\n    const absolutely = window.scrollY / section.scrollHeight * 100;\n    setScrollWidth(absolutely.toFixed(2) + '%');\n  };\n\n  const disposeLikeTody = () => {\n    if (!localStorage.getItem('currentLike')) {\n      localStorage.setItem('currentLike', JSON.stringify([]));\n      setLikeTody(false);\n    } else {\n      const currentLike = JSON.parse(localStorage.getItem('currentLike'));\n\n      if (currentLike.find(item => item.id === props.blogDetail.id)) {\n        setLikeTody(true);\n      }\n    }\n  };\n\n  const renderContent = () => /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(\"h1\", {\n      children: blogDetail.title\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: Styles.stuff,\n      children: [/*#__PURE__*/_jsx(\"span\", {\n        children: moment(blogDetail.createDate).format('YYYY-MM-DD')\n      }), /*#__PURE__*/_jsxs(\"span\", {\n        children: [\"\\u9605\\u8BFB\\xA0\", blogDetail.viewCount]\n      }), /*#__PURE__*/_jsxs(\"span\", {\n        children: [\"\\u5B57\\u7B26\\xA0\", blogDetail.number_words]\n      }), /*#__PURE__*/_jsx(\"span\", {\n        children: \"\\u8BC4\\u8BBA\\xA01920\"\n      }), /*#__PURE__*/_jsxs(\"span\", {\n        children: [\"\\u559C\\u6B22\\xA0\", blogDetail.likeCount]\n      })]\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: Styles.content,\n      children: /*#__PURE__*/_jsx(\"div\", {\n        className: Styles.blogDetail,\n        dangerouslySetInnerHTML: {\n          __html: marked(blogDetail.content, {\n            gfm: true,\n            xhtml: false\n          })\n        }\n      })\n    })]\n  });\n\n  const onOk = () => {\n    const {\n      id\n    } = props.blogDetail;\n    const currentLike = JSON.parse(localStorage.getItem('currentLike'));\n\n    if (currentLike.find(item => item.id === id)) {\n      setLikeTody(true);\n      return message.warn('你已经点过赞了');\n    }\n\n    currentLike.push({\n      id,\n      todyLike: true\n    });\n    setLikeTody(true);\n    localStorage.setItem('currentLike', JSON.stringify(currentLike));\n    goodLikeBlog({\n      id: blogDetail.id,\n      like: true\n    });\n    message.success('good.');\n  };\n\n  const submitComment = async () => {\n    if (commentName.trim() === '') {\n      return setErrorInfo('×请留下你的大名.');\n    }\n\n    if (!Email.test(commentEmail.trim())) {\n      return setErrorInfo('×请输入正确的邮箱.');\n    }\n\n    if (context.trim() === '') {\n      return setErrorInfo('×0分作文');\n    }\n\n    setValidation(true);\n  };\n\n  const inputContext = e => {\n    const name = e.target.name;\n    const value = e.target.value;\n\n    if (name == 'name') {\n      setCommentName(value);\n    } else if (name == 'email') {\n      setCommentEmail(value);\n    }\n  };\n\n  const textareaInputContext = e => {\n    setContext(e.target.value);\n  };\n\n  const renderComment = () => /*#__PURE__*/_jsx(\"div\", {\n    className: Styles.comment_user,\n    children: comment.map(item => /*#__PURE__*/_jsxs(\"div\", {\n      className: Styles.comment_user_list,\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: Styles.describe,\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: Styles.describe_left,\n          children: /*#__PURE__*/_jsx(\"img\", {\n            src: \"/image/4.jpg\",\n            alt: \"\"\n          })\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: Styles.describe_right,\n          children: [/*#__PURE__*/_jsx(\"span\", {\n            children: item.commentName\n          }), /*#__PURE__*/_jsx(\"span\", {\n            children: moment(item.createTime).format('HH:MM YYYY-MM-DD')\n          })]\n        })]\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: Styles.content,\n        children: item.context\n      })]\n    }, item.id))\n  });\n\n  const verifyResponse = async flg => {\n    if (!flg) return;\n    setTimeout(() => setValidation(false), 600);\n    const {\n      success\n    } = await blog_createComment({\n      articleId: props.blogDetail.id,\n      commentName,\n      commentEmail,\n      createTime: moment(new Date()).format('YYYY-MM-DD HH:MM'),\n      context\n    });\n    if (!success) return;\n    setErrorInfo('~认真和用心是一种态度, 感谢支持~');\n    setCommentName('');\n    setCommentEmail('');\n    setContext('');\n    const {\n      success: commentSuccess,\n      data\n    } = await get_blogComment({\n      id: props.blogDetail.id,\n      pageNo: 1,\n      pageSize: pageSize\n    });\n    if (!commentSuccess) return;\n    setComment(data.list);\n    setTotal(data.total);\n  };\n\n  const closeVerify = () => {\n    setValidation(false);\n  }; // 加载更多\n\n\n  const loadMore = async e => {\n    e.stopPropagation();\n    SetLoading(true);\n    const {\n      success,\n      data\n    } = await get_blogComment({\n      id: props.blogDetail.id,\n      pageNo: 1,\n      pageSize: pageSize + 5\n    });\n    setPageSize(pageSize + 5);\n    if (!success) return message.warn('请求错误');\n    SetLoading(false);\n    setComment(data.list);\n    setTotal(data.total);\n  };\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: Styles.bigBox,\n    children: [/*#__PURE__*/_jsx(\"div\", {\n      className: Styles.scrollbar,\n      style: {\n        width: scrollWidth\n      }\n    }), /*#__PURE__*/_jsx(PageHeader, {\n      logo: true,\n      title: blogDetail.title,\n      likeTody: likeTody,\n      onOk: onOk,\n      blogId: blogDetail.id,\n      type: headerType.blog_detail\n    }), /*#__PURE__*/_jsx(\"section\", {\n      className: Styles.section,\n      id: \"section\",\n      children: renderContent()\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: Styles.comment,\n      children: /*#__PURE__*/_jsxs(\"section\", {\n        className: Styles.comment_section,\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: Styles.comment_form,\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: Styles.commentInput,\n            children: [/*#__PURE__*/_jsx(\"input\", {\n              type: \"text\",\n              placeholder: \"Name\",\n              value: commentName,\n              name: \"name\",\n              onChange: inputContext\n            }), /*#__PURE__*/_jsx(\"input\", {\n              type: \"text\",\n              placeholder: \"Email\",\n              value: commentEmail,\n              name: \"email\",\n              onChange: inputContext\n            })]\n          }), /*#__PURE__*/_jsx(\"textarea\", {\n            placeholder: \"\\u8BF4\\u70B9\\u4EC0\\u4E48\\u5462...\",\n            name: \"context\",\n            value: context,\n            onChange: textareaInputContext\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: Styles.subBtn,\n            children: [/*#__PURE__*/_jsx(\"button\", {\n              onClick: submitComment,\n              children: \"SUBMIT\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: Styles.charts,\n              style: errorInfo.length <= 17 ? {\n                color: \"red\"\n              } : {\n                color: '#909090'\n              },\n              children: errorInfo\n            })]\n          })]\n        }), /*#__PURE__*/_jsxs(\"h2\", {\n          className: Styles.comment_title,\n          children: [/*#__PURE__*/_jsx(\"span\", {\n            children: \"Comment List\"\n          }), /*#__PURE__*/_jsxs(\"span\", {\n            children: [\"(\", total, \")\"]\n          })]\n        }), renderComment(), /*#__PURE__*/_jsx(\"div\", {\n          className: Styles.more,\n          children: total === comment.length ? /*#__PURE__*/_jsx(\"div\", {\n            className: Styles.bottomTest,\n            children: \"\\u5230\\u5E95\\u4E86\"\n          }) : loadingMore ? /*#__PURE__*/_jsx(LoadingDom, {}) : /*#__PURE__*/_jsx(\"div\", {\n            className: Styles.loadingBtn,\n            onClick: loadMore,\n            children: \"\\u52A0\\u8F7D\\u66F4\\u591A \"\n          })\n        })]\n      })\n    }), openValidation ? /*#__PURE__*/_jsx(\"div\", {\n      className: Styles.mask,\n      children: /*#__PURE__*/_jsx(PuzzleVerify, {\n        verifyResponse: verifyResponse,\n        close: closeVerify\n      })\n    }) : null]\n  });\n};\n\nexport async function getStaticPaths() {\n  const {\n    data,\n    success\n  } = await getIndexPageData();\n  if (!success) return message.warn('请求错误-getStaticPaths');\n  const paths = data.list.map(item => ({\n    params: {\n      id: String(item.id)\n    }\n  }));\n  return {\n    paths,\n    fallback: false\n  };\n}\nexport async function getStaticProps({\n  params\n}) {\n  const {\n    success,\n    data\n  } = await getBlogDetail({\n    id: params.id\n  });\n  if (!success) return message.warn('请求错误---getStaticProps');\n  return {\n    props: {\n      blogDetail: data[0]\n    }\n  };\n}\nexport default BlogDetail;","map":null,"metadata":{},"sourceType":"module"}