{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect } from 'react';\nimport moment from 'moment';\nimport Header from './components/Header';\nimport { useRouter } from 'next/router';\nimport Styles from '../styles/Article/index.module.scss';\nimport { blogCategorize } from '../api/api';\nimport { headerType } from '../types/response';\nimport { mouthEN } from '../util/mouthEN';\nvar pageSize = 10;\n\nvar Article = function Article(props) {\n  var _useState = useState(props.blogAll),\n      blogList = _useState[0],\n      setBlogList = _useState[1];\n\n  var _useState2 = useState(false),\n      bottomChar = _useState2[0],\n      setBottomChar = _useState2[1];\n\n  var router = useRouter();\n  useEffect(function () {\n    // 判断是否出现滚动条\n    var hasScrollbar = function hasScrollbar() {\n      return document.body.scrollHeight > (window.innerHeight || document.documentElement.clientHeight);\n    }; // 计算分类后数据的总长度\n\n\n    var disposeArrLength = function disposeArrLength(arr) {\n      return arr.reduce(function (i, j) {\n        return i.data.length + j.data.length;\n      });\n    };\n\n    setBottomChar(hasScrollbar());\n\n    var moveBottom = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n        var scrollTop, windowHeight, scrollHeight, _yield$blogCategorize, data, success;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!(props.total === disposeArrLength(blogList))) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", setBottomChar(true));\n\n              case 2:\n                scrollTop = document.documentElement.scrollTop || document.body.scrollTop;\n                windowHeight = document.documentElement.clientHeight || document.body.clientHeight;\n                scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight;\n\n                if (!(scrollTop + windowHeight == scrollHeight)) {\n                  _context.next = 17;\n                  break;\n                }\n\n                pageSize = pageSize + 5;\n                _context.next = 9;\n                return blogCategorize({\n                  pageNo: 0,\n                  pageSize: pageSize\n                });\n\n              case 9:\n                _yield$blogCategorize = _context.sent;\n                data = _yield$blogCategorize.data;\n                success = _yield$blogCategorize.success;\n\n                if (success) {\n                  _context.next = 14;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 14:\n                setBlogList(disposeBlogFiled(data.list));\n\n                if (!(props.total === data.list.length)) {\n                  _context.next = 17;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", setBottomChar(true));\n\n              case 17:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function moveBottom(_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    window.addEventListener('scroll', moveBottom, false);\n    return function () {\n      return window.removeEventListener('scroll', moveBottom, false);\n    };\n  }, []);\n\n  var jumpPage = function jumpPage(id) {\n    router.push(\"/\".concat(id));\n  };\n\n  var renderMonth = function renderMonth(blog) {\n    return blog.map(function (item, index) {\n      return /*#__PURE__*/_jsx(\"div\", {\n        className: Styles.year_list,\n        children: /*#__PURE__*/_jsxs(\"ul\", {\n          className: Styles.month_list,\n          children: [/*#__PURE__*/_jsx(\"li\", {\n            className: Styles.month,\n            children: item.month\n          }), /*#__PURE__*/_jsx(\"ul\", {\n            className: Styles.day,\n            children: renderListBlog(item.data)\n          })]\n        })\n      }, index + '1');\n    });\n  };\n\n  var renderListBlog = function renderListBlog(blog) {\n    return blog.map(function (item) {\n      return /*#__PURE__*/_jsxs(\"li\", {\n        className: Styles.day_detail,\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: Styles.img,\n          children: /*#__PURE__*/_jsx(\"img\", {\n            src: item.imgUrl,\n            alt: \"\",\n            onClick: function onClick() {\n              return jumpPage(item.id);\n            }\n          })\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: Styles[\"char\"],\n          children: [/*#__PURE__*/_jsx(\"h3\", {\n            onClick: function onClick() {\n              return jumpPage(item.id);\n            },\n            children: item.title\n          }), /*#__PURE__*/_jsxs(\"span\", {\n            children: [item.likeCount, \" LIKE / \", item.viewCount, \" READ\"]\n          })]\n        }), /*#__PURE__*/_jsxs(\"span\", {\n          className: Styles.item_r,\n          children: [item.day, \"Day\"]\n        })]\n      }, item.id);\n    });\n  };\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: Styles.page,\n    children: [/*#__PURE__*/_jsx(Header, {\n      type: headerType.blog_detail\n    }), /*#__PURE__*/_jsxs(\"section\", {\n      className: Styles.home,\n      children: [renderMonth(blogList), bottomChar ? /*#__PURE__*/_jsx(\"div\", {\n        className: Styles.bottom,\n        children: \"\\u545C\\u545C,\\u5DF2\\u7ECF\\u88AB\\u638F\\u7A7A\\u4E86\"\n      }) : null]\n    })]\n  });\n};\n\nexport var __N_SSG = true;\nexport default Article;\n\nvar disposeBlogFiled = function disposeBlogFiled(list) {\n  var mapAddMouth = list.map(function (item) {\n    return _objectSpread(_objectSpread({}, item), {}, {\n      day: moment(item.createDate).format('DD'),\n      createDate: moment(item.createDate).format('YYYY-MM-DD'),\n      month: moment(item.createDate).format('YYYY-MM')\n    });\n  });\n  var classify = mapAddMouth.reduce(function (last, item) {\n    if (last[item.month]) {\n      last[item.month].push(item);\n    } else {\n      last[item.month] = [item];\n    }\n\n    return last;\n  }, {});\n  var arr = [];\n\n  for (var iterator in classify) {\n    var fistChar = iterator.split('-')[0];\n    var lastChar = Number(iterator.split('-')[1]);\n    arr.push({\n      month: mouthEN[lastChar] + ',' + fistChar,\n      data: classify[iterator]\n    });\n  }\n\n  return arr;\n};","map":null,"metadata":{},"sourceType":"module"}