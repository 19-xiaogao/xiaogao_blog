{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport React, { useEffect, useState } from 'react';\nimport Styles from '../styles/blogDetail/index.module.scss';\nimport moment from 'moment';\nimport marked from 'marked';\nimport { message } from 'antd';\nimport PageHeader from './components/Header';\nimport PuzzleVerify from './components/puzzleVerify';\nimport { goodLikeBlog, blog_createComment, get_blogComment } from '../api/api';\nimport LoadingDom from './components/loading';\nimport { headerType } from '../types/response';\nimport { Email } from '../util/RegExp';\n\nvar BlogDetail = function BlogDetail(props) {\n  var section = null;\n\n  var _useState = useState([]),\n      comment = _useState[0],\n      setComment = _useState[1];\n\n  var _useState2 = useState(0),\n      total = _useState2[0],\n      setTotal = _useState2[1];\n\n  var _useState3 = useState(false),\n      likeTody = _useState3[0],\n      setLikeTody = _useState3[1];\n\n  var _useState4 = useState('0%'),\n      scrollWidth = _useState4[0],\n      setScrollWidth = _useState4[1];\n\n  var _useState5 = useState(''),\n      commentName = _useState5[0],\n      setCommentName = _useState5[1];\n\n  var _useState6 = useState(''),\n      commentEmail = _useState6[0],\n      setCommentEmail = _useState6[1];\n\n  var _useState7 = useState(''),\n      context = _useState7[0],\n      setContext = _useState7[1];\n\n  var _useState8 = useState('~认真和用心是一种态度, 感谢支持~'),\n      errorInfo = _useState8[0],\n      setErrorInfo = _useState8[1];\n\n  var _useState9 = useState(false),\n      openValidation = _useState9[0],\n      setValidation = _useState9[1];\n\n  var _useState10 = useState(5),\n      pageSize = _useState10[0],\n      setPageSize = _useState10[1];\n\n  var _useState11 = useState(false),\n      loadingMore = _useState11[0],\n      SetLoading = _useState11[1];\n\n  var blogDetail = props.blogDetail;\n  useEffect(function () {\n    section = document.getElementById('section');\n    goodLikeBlog({\n      id: blogDetail.id,\n      like: false\n    });\n    disposeLikeTody();\n    window.addEventListener('scroll', scrollBar, false);\n    return function () {\n      return window.removeEventListener('scroll', scrollBar, false);\n    };\n  }, []); // 获取评论数据\n\n  useEffect(function () {\n    _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _yield$get_blogCommen, success, data;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return get_blogComment({\n                id: props.blogDetail.id,\n                pageNo: 1,\n                pageSize: pageSize\n              });\n\n            case 2:\n              _yield$get_blogCommen = _context.sent;\n              success = _yield$get_blogCommen.success;\n              data = _yield$get_blogCommen.data;\n\n              if (success) {\n                _context.next = 7;\n                break;\n              }\n\n              return _context.abrupt(\"return\", message.warn('请求错误---getStaticProps'));\n\n            case 7:\n              setComment(data.list);\n              setTotal(data.total);\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  }, []);\n\n  var scrollBar = function scrollBar() {\n    var absolutely = window.scrollY / section.scrollHeight * 100;\n    setScrollWidth(absolutely.toFixed(2) + '%');\n  };\n\n  var disposeLikeTody = function disposeLikeTody() {\n    if (!localStorage.getItem('currentLike')) {\n      localStorage.setItem('currentLike', JSON.stringify([]));\n      setLikeTody(false);\n    } else {\n      var currentLike = JSON.parse(localStorage.getItem('currentLike'));\n\n      if (currentLike.find(function (item) {\n        return item.id === props.blogDetail.id;\n      })) {\n        setLikeTody(true);\n      }\n    }\n  };\n\n  var renderContent = function renderContent() {\n    return /*#__PURE__*/_jsxs(_Fragment, {\n      children: [/*#__PURE__*/_jsx(\"h1\", {\n        children: blogDetail.title\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: Styles.stuff,\n        children: [/*#__PURE__*/_jsx(\"span\", {\n          children: moment(blogDetail.createDate).format('YYYY-MM-DD')\n        }), /*#__PURE__*/_jsxs(\"span\", {\n          children: [\"\\u9605\\u8BFB\\xA0\", blogDetail.viewCount]\n        }), /*#__PURE__*/_jsxs(\"span\", {\n          children: [\"\\u5B57\\u7B26\\xA0\", blogDetail.number_words]\n        }), /*#__PURE__*/_jsx(\"span\", {\n          children: \"\\u8BC4\\u8BBA\\xA01920\"\n        }), /*#__PURE__*/_jsxs(\"span\", {\n          children: [\"\\u559C\\u6B22\\xA0\", blogDetail.likeCount]\n        })]\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: Styles.content,\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: Styles.blogDetail,\n          dangerouslySetInnerHTML: {\n            __html: marked(blogDetail.content, {\n              gfm: true,\n              xhtml: false\n            })\n          }\n        })\n      })]\n    });\n  };\n\n  var onOk = function onOk() {\n    var id = props.blogDetail.id;\n    var currentLike = JSON.parse(localStorage.getItem('currentLike'));\n\n    if (currentLike.find(function (item) {\n      return item.id === id;\n    })) {\n      setLikeTody(true);\n      return message.warn('你已经点过赞了');\n    }\n\n    currentLike.push({\n      id: id,\n      todyLike: true\n    });\n    setLikeTody(true);\n    localStorage.setItem('currentLike', JSON.stringify(currentLike));\n    goodLikeBlog({\n      id: blogDetail.id,\n      like: true\n    });\n    message.success('good.');\n  };\n\n  var submitComment = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(commentName.trim() === '')) {\n                _context2.next = 2;\n                break;\n              }\n\n              return _context2.abrupt(\"return\", setErrorInfo('×请留下你的大名.'));\n\n            case 2:\n              if (Email.test(commentEmail.trim())) {\n                _context2.next = 4;\n                break;\n              }\n\n              return _context2.abrupt(\"return\", setErrorInfo('×请输入正确的邮箱.'));\n\n            case 4:\n              if (!(context.trim() === '')) {\n                _context2.next = 6;\n                break;\n              }\n\n              return _context2.abrupt(\"return\", setErrorInfo('×0分作文'));\n\n            case 6:\n              setValidation(true);\n\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function submitComment() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var inputContext = function inputContext(e) {\n    var name = e.target.name;\n    var value = e.target.value;\n\n    if (name == 'name') {\n      setCommentName(value);\n    } else if (name == 'email') {\n      setCommentEmail(value);\n    }\n  };\n\n  var textareaInputContext = function textareaInputContext(e) {\n    setContext(e.target.value);\n  };\n\n  var renderComment = function renderComment() {\n    return /*#__PURE__*/_jsx(\"div\", {\n      className: Styles.comment_user,\n      children: comment.map(function (item) {\n        return /*#__PURE__*/_jsxs(\"div\", {\n          className: Styles.comment_user_list,\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: Styles.describe,\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: Styles.describe_left,\n              children: /*#__PURE__*/_jsx(\"img\", {\n                src: \"/image/4.jpg\",\n                alt: \"\"\n              })\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: Styles.describe_right,\n              children: [/*#__PURE__*/_jsx(\"span\", {\n                children: item.commentName\n              }), /*#__PURE__*/_jsx(\"span\", {\n                children: moment(item.createTime).format('HH:MM YYYY-MM-DD')\n              })]\n            })]\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: Styles.content,\n            children: item.context\n          })]\n        }, item.id);\n      })\n    });\n  };\n\n  var verifyResponse = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(flg) {\n      var _yield$blog_createCom, success, _yield$get_blogCommen2, commentSuccess, data;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (flg) {\n                _context3.next = 2;\n                break;\n              }\n\n              return _context3.abrupt(\"return\");\n\n            case 2:\n              setTimeout(function () {\n                return setValidation(false);\n              }, 600);\n              _context3.next = 5;\n              return blog_createComment({\n                articleId: props.blogDetail.id,\n                commentName: commentName,\n                commentEmail: commentEmail,\n                createTime: moment(new Date()).format('YYYY-MM-DD HH:MM'),\n                context: context\n              });\n\n            case 5:\n              _yield$blog_createCom = _context3.sent;\n              success = _yield$blog_createCom.success;\n\n              if (success) {\n                _context3.next = 9;\n                break;\n              }\n\n              return _context3.abrupt(\"return\");\n\n            case 9:\n              setErrorInfo('~认真和用心是一种态度, 感谢支持~');\n              setCommentName('');\n              setCommentEmail('');\n              setContext('');\n              _context3.next = 15;\n              return get_blogComment({\n                id: props.blogDetail.id,\n                pageNo: 1,\n                pageSize: pageSize\n              });\n\n            case 15:\n              _yield$get_blogCommen2 = _context3.sent;\n              commentSuccess = _yield$get_blogCommen2.success;\n              data = _yield$get_blogCommen2.data;\n\n              if (commentSuccess) {\n                _context3.next = 20;\n                break;\n              }\n\n              return _context3.abrupt(\"return\");\n\n            case 20:\n              setComment(data.list);\n              setTotal(data.total);\n\n            case 22:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function verifyResponse(_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var closeVerify = function closeVerify() {\n    setValidation(false);\n  }; // 加载更多\n\n\n  var loadMore = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(e) {\n      var _yield$get_blogCommen3, success, data;\n\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              e.stopPropagation();\n              SetLoading(true);\n              _context4.next = 4;\n              return get_blogComment({\n                id: props.blogDetail.id,\n                pageNo: 1,\n                pageSize: pageSize + 5\n              });\n\n            case 4:\n              _yield$get_blogCommen3 = _context4.sent;\n              success = _yield$get_blogCommen3.success;\n              data = _yield$get_blogCommen3.data;\n              setPageSize(pageSize + 5);\n\n              if (success) {\n                _context4.next = 10;\n                break;\n              }\n\n              return _context4.abrupt(\"return\", message.warn('请求错误'));\n\n            case 10:\n              SetLoading(false);\n              setComment(data.list);\n              setTotal(data.total);\n\n            case 13:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function loadMore(_x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: Styles.bigBox,\n    children: [/*#__PURE__*/_jsx(\"div\", {\n      className: Styles.scrollbar,\n      style: {\n        width: scrollWidth\n      }\n    }), /*#__PURE__*/_jsx(PageHeader, {\n      logo: true,\n      title: blogDetail.title,\n      likeTody: likeTody,\n      onOk: onOk,\n      blogId: blogDetail.id,\n      type: headerType.blog_detail\n    }), /*#__PURE__*/_jsx(\"section\", {\n      className: Styles.section,\n      id: \"section\",\n      children: renderContent()\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: Styles.comment,\n      children: /*#__PURE__*/_jsxs(\"section\", {\n        className: Styles.comment_section,\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: Styles.comment_form,\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: Styles.commentInput,\n            children: [/*#__PURE__*/_jsx(\"input\", {\n              type: \"text\",\n              placeholder: \"Name\",\n              value: commentName,\n              name: \"name\",\n              onChange: inputContext\n            }), /*#__PURE__*/_jsx(\"input\", {\n              type: \"text\",\n              placeholder: \"Email\",\n              value: commentEmail,\n              name: \"email\",\n              onChange: inputContext\n            })]\n          }), /*#__PURE__*/_jsx(\"textarea\", {\n            placeholder: \"\\u8BF4\\u70B9\\u4EC0\\u4E48\\u5462...\",\n            name: \"context\",\n            value: context,\n            onChange: textareaInputContext\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: Styles.subBtn,\n            children: [/*#__PURE__*/_jsx(\"button\", {\n              onClick: submitComment,\n              children: \"SUBMIT\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: Styles.charts,\n              style: errorInfo.length <= 17 ? {\n                color: \"red\"\n              } : {\n                color: '#909090'\n              },\n              children: errorInfo\n            })]\n          })]\n        }), /*#__PURE__*/_jsxs(\"h2\", {\n          className: Styles.comment_title,\n          children: [/*#__PURE__*/_jsx(\"span\", {\n            children: \"Comment List\"\n          }), /*#__PURE__*/_jsxs(\"span\", {\n            children: [\"(\", total, \")\"]\n          })]\n        }), renderComment(), /*#__PURE__*/_jsx(\"div\", {\n          className: Styles.more,\n          children: total === comment.length ? /*#__PURE__*/_jsx(\"div\", {\n            className: Styles.bottomTest,\n            children: \"\\u5230\\u5E95\\u4E86\"\n          }) : loadingMore ? /*#__PURE__*/_jsx(LoadingDom, {}) : /*#__PURE__*/_jsx(\"div\", {\n            className: Styles.loadingBtn,\n            onClick: loadMore,\n            children: \"\\u52A0\\u8F7D\\u66F4\\u591A \"\n          })\n        })]\n      })\n    }), openValidation ? /*#__PURE__*/_jsx(\"div\", {\n      className: Styles.mask,\n      children: /*#__PURE__*/_jsx(PuzzleVerify, {\n        verifyResponse: verifyResponse,\n        close: closeVerify\n      })\n    }) : null]\n  });\n};\n\nexport var __N_SSG = true;\nexport default BlogDetail;","map":null,"metadata":{},"sourceType":"module"}